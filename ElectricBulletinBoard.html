<html lang="ja">
<head>
  <meta charset="UTF-8">
	<title>ElectricBulletinBoard</title>

  <meta name="robots" content="noindex">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">

  <link rel="manifest" href="./manifest.json">
  <meta name="apple-mobile-web-app-title" content="ElectricBulletinBoard">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<link rel="apple-touch-icon-precomposed" href="./icon.jpg">
  <link rel="apple-touch-startup-image" href="./icon.jpg">
  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#ffffff">


  <link rel="shortcut icon" href="./favicon.ico" type="image/vnd.microsoft.icon">

  <style>

body{
  overflow: hidden;
  width: 100vw;
  height: 100vh;
  margin: 0px;
  padding: 0px;
}

#message {
  display: inline-block;
  white-space: nowrap;

  animation-name: MarqueeScrollHorizontal;
  animation-timing-function: linear;
  animation-iteration-count: infinite;

  font-size: 50vh;
  line-height: 70vh;
  margin: 15vh 0px 0px 0px

}
@keyframes MarqueeScrollHorizontal{
  from { transform: translateX(0);}
  to { transform: translateX(-100%);}
}


#setting-bg{
  display: block;
  position: absolute;

  top: 0px;
  left: 0px;
  width: 60vw;
  height: 60vh;
  margin: 20vh 20vw;

  background-color: rgba(0,0,0, 0.5); 
}
#setting{
  top: 0px;
  left: 0px;
  width: 90%;
  height: 90%;
  margin: 30px; 

  color: black;
  font-size: 5vh;

  border: 2px solid gray;
}

#setting > input {
  font-size: 5vh;
  width: 100%;
}
#setting > select {
  font-size: 5vh;
  width: 100%;
}
#setting > button {
  font-size: 5vh;
}

input[type="text"]{
    outline: none;
    border: 4px solid white;
    -webkit-transition: all .3s;
    transition: all .3s;
}
input[type="text"]:focus {
  box-shadow: 0 0 15px #00ffff;
  border: 4px solid #00ffff;
}


/* for smart phone */
@media screen and (orientation:portrait) and (max-width: 1680px){
  body{
    transform:rotate(90deg);
  }
  #message{
    font-size: 50vw;
    line-height: 70vw;
    margin: 20vw 0px 0px 0px
  }
  #setting-bg{
    left: -20vh;
    width: 60vh;
    height: 80vw;
    margin: 20vw 20vh;
  }

}

  </style>

  <script type="text/javascript">
/**************************************/
var MessageText;


// スクロールを禁止にする関数
function disableScroll(event) {
  event.preventDefault();
}

function init(){
  console.log("> init()");

  let t = "テストメッセージが流れていきます～"; //localStrageに変更予定
  setMessageText(t);

  const msg_i = document.getElementById("message-input");
  msg_i.value = t;
  msg_i.addEventListener("focus", startChangingMessage, false);
  msg_i.focus();
  msg_i.addEventListener("blur",  stopChangingMessage, false);
  msg_i.addEventListener("keydown", startChangingMessage, false);

  
  // スクロール禁止
  document.getElementById('on').onclick = function() {
    // イベントと関数を紐付け
    document.addEventListener('touchmove', disableScroll, { passive: false });
    document.addEventListener('mousewheel', disableScroll, { passive: false });
  }
}

/**************************************/
function setMessageText(text){
  const msg = document.getElementById("message");
  msg.innerHTML = text;
  MessageText = text;
  setSpeed( getMessageLen() );
}
function getMessageLen(){
  const msg = document.getElementById("message");
  return msg.innerHTML.length;
}
/* 1周するのにかかる時間 */
function setSpeed(sec){
  document.getElementById("message").style.animationDuration = sec+"s";
}

/**************************************/
function closeSetting(){
  console.log("> closeSetting()");
  document.getElementById("setting-bg").style.display="none";
  event.stopPropagation()
}
function openSetting(){
  console.log("> openSetting()");
  const e = document.getElementById("setting-bg");
  if(e.style.display == "none" || e.style.display == ""){
    document.getElementById("setting-bg").style.display="block";
    document.getElementById("message-input").focus();
  }
  event.stopPropagation()
}

/**************************************/
var MessageTimer;
function startChangingMessage(){
  //console.log("> startChangingMessage()");
  stopChangingMessage();
  MessageTimer = window.setInterval(changeMessage, 600);
}
function stopChangingMessage(){
  //console.log("> stopChangingMessage()");
  try{
      window.clearInterval(MessageTimer);
  }catch(e){}
}
function changeMessage(){
  const msg_i = document.getElementById("message-input");
  let v = msg_i.value;
  if(v != MessageText){
    console.log("> changeMessage() ditected change");
    setMessageText(v);
  }else{
    console.log("> changeMessage() not change");
  }
}

/**************************************/

  </script>

</head>
<body onload="init()" onclick="openSetting()">
  <span id="message">テストメッセージが流れていきます～</span>
  <div id="setting-bg"><div id="setting">
    <input id="message-input" type="text" value="">
    <br>
    <select id="speed" name="speed">
      <option value="1">default speed</option>
      <option value="2">fast</option>
      <option value="0.5">slow</option>
    </select>
    <br>
    <br>
    <button type="button" onclick="closeSetting()">GO</button>
  </></>
</body>
</html>
